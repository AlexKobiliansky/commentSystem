{% extends 'base.html.twig' %}



{% block javascripts %}
    {{ parent() }}

{% endblock %}


{% block content %}

{% for comment in comments %}
    {% if(comment.parent == null) %}
        <section class="comment">
            {% if not comment.UserAvatar %}
                <img src='/web/avatars/no_avatar.jpg'>
            {% else %}
                <img src='/web/avatars/{{ comment.UserAvatar }}'>
            {% endif %}
            <div class="comment-header">
                <p>
                    <span id="login">{{ comment.UserLogin }}</span>
                    <span id="date">{{ comment.dateCreated|date('j.m.Y, G:i') }}</span>
                    {% if comment.UserId == current_user %}
                        <a href="/index.php?controller=comments&action=delete&id={{ comment.id }}&login={{ comment.UserLogin }}">
                            <span class="glyphicon glyphicon-remove"></span>
                        </a>
                        <a href="/index.php?controller=comments&action=edit&id={{ comment.id }}">
                            <span class="glyphicon glyphicon-edit"></span>
                        </a>
                    {% endif %}
                </p>
            </div>

            <div class="comment-content">
                <p>
                    {{ comment.content }}<br />


                    Likes: {{ comment.likes }}
                    <a href="/index.php?controller=comments&action=like&id={{ comment.id }}">test</a>




                    <span class="glyphicon glyphicon-heart" id="like_hart{{ comment.id }}" style="color:lightblue"></span>

                    <span style="cursor: pointer;" id="like{{ comment.id }}" data-id="{{ comment.id }}" >
                    {{ comment.likes }}
                </span>

                </p>
            </div>




            <input type="button" class="button btn btn-default btn-xs" value="Answer"
                   onClick='$("#form"+{{ comment.id }}).show()'>
        </section>

        <div class="subcommentform" id="form{{ comment.id }}">
    {{ comment.id }}
            <form method="POST" action="/index.php?controller=comments&action=createSubcomment&parent_id={{ comment.id }}">

                <label for="content">Content</label>
                <textarea id="content" name="content">{{ content }}</textarea>

                <input type="submit" value="Update">
            </form>
        </div>

            <div class="subcomment">
                {% include 'subcomments.html.twig' with {'comments':comment.children, 'foo':comment.children} %}
            </div>

        {% endif %}





    <script>
        $(document).ready(function() {
            $("#like"+{{ comment.id }}).bind("click", function(event) {
                $.ajax({
                    url: "/index.php?controller=comments&action=like&id={{ comment.id }}",
                    type: "GET",
                    data: ($("#like"+{{ comment.id }}).attr("data-id")),
                    dataType: "text",
                    success: function(result) {
                        if (result) {
                            var res = JSON.parse(result);
                            $("#like"+{{ comment.id }}).text(res[0]);
                            $("#like_hart"+{{ comment.id }}).css('color', res[1]);

                        }
                        else $("#like"+{{ comment.id }}).text('?');
                    }
                });
            });
        });
    </script>









{% endfor %}
    <h1>Add new Comment</h1>
    {{ message }}
    <form method="POST" action="/index.php?controller=comments&action=new">
        <label for="content">Content</label>
        <textarea id="content" name="content"></textarea>
        <input type="submit" value="Create">
    </form>




    <script>
        $(".subcommentform").hide();
    </script>




{% endblock %}